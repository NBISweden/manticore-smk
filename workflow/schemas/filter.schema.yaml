$schema: "http://json-schema.org/draft-07/schema#"

description: Filter definitions

type: object

definitions:

  filter:
    type: object
    description: >-
        filters to apply to input data; for individuals always vcf? For
        pool, either pileup or sync files
    default: {}
    properties:
      description:
        type: string
        description: optional description of the filtering step
      tool:
        type: string
        $ref: "definitions.schema.yaml#/definitions/tool"
      options:
        description: filter options
        default: null
        $ref: "definitions.schema.yaml#/definitions/options"
      input:
        type: object
        description: >-
          specific input files that either are user supplied or
          generated by another rule
    additionalProperties: false

  # Defined filters; need separate definitions to ensure unique array
  # key names
  selectFilter:
    type: object
    description: >-
        select specific type of variants
    examples:
      - select:
          options: --select-type-to-include SNP
          tool: gatk
      - select:
          options: --types snps
          tool: bcftools
    properties:
      select:
        type: object
        $ref: "#/definitions/filter"
    additionalProperties: false

  varFilter:
    type: object
    description: >-
        filter variants based on variant statistics
    examples:
      - filter:
          options: ["QD < 2.0", "MQ < 40.0", "FS > 60.0", "MQRankSum < -12.5", "ReadPosRankSum < -8.0", "SOR > 3.0"]
          tool: gatk
      - filter: # Untested
          options: -i QD < 2.0 & MQ < 40.0 & FS > 60.0 & MQRankSum < -12.5 & ReadPosRankSum < -8.0 & SOR > 3.0
          tool: bcftools
    properties:
      filter:
        type: object
        $ref: "#/definitions/filter"
    additionalProperties: false

  concatFilter:
    type: object
    description: >-
        merge/concatenate variants
    properties:
      concat:
        type: object
        $ref: "#/definitions/filter"
    additionalProperties: false

  convertFilter:
    type: object
    properties:
      convert:
        type: object
        $ref: "#/definitions/filter"
    additionalProperties: false

  maskFilter:
    type: object
    properties:
      mask:
        type: object
        $ref: "#/definitions/filter"
    additionalProperties: false

  analysisfilters:
    type: array
    description: >-
        filters to be run on a data object. This section appears in an
        analysis set
    items:
      oneOf:
      - type: object
        $ref: "#/definitions/selectFilter"
      - type: object
        $ref: "#/definitions/varFilter"
      - type: object
        $ref: "#/definitions/convertFilter"
      - type: object
        $ref: "#/definitions/concatFilter"
      - type: object
        $ref: "#/definitions/maskFilter"
