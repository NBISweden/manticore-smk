manticore-smk workflow results
==============================

manticore-smk_ is a Snakemake workflow for non model organism variant
calling and population genomics analyses. This analysis is based on
commit version {{ snakemake.config["__workflow_commit__"] }}_.

The analysis can be rerun with the following command:

.. code-block:: shell

   cd {{ snakemake.config["__workflow_workdir__"] }}
{% if snakemake.config["__workflow_basedir__"] == snakemake.config["__workflow_workdir__"] %}
   snakemake -j 1 --use-conda
{% else %}
   snakemake -j 1 --use-conda -s {{ snakemake.config["__workflow_basedir__"] }}/Snakefile
{% endif %}


Workflow summary
----------------

The workflow runs the following steps:

1. read trimming (optional)
2. read mapping
3. raw variant calling
4. variant filtering
5. calculation of population genomics statistics
6. multiple qc checks


Data organization
=================

.. code-block:: text

   {{ snakemake.config["__workflow_workdir__"] }}/                    <- top-level project folder
   |
   ├── config                   <- configuration directory for Snakemake and other things
   │
   ├── data
   │   ├── external             <- data from third party sources
   │   ├── interim              <- Intermediate data that can be safely deleted
   │   ├── metadata             <- metadata describing raw data files
   │   ├── processed            <- Final processed data used for analyses
   │   └── raw                  <- The original immutable data dump to be treated as read-only.
   │
   ├── logs                     <- Collection of log outputs, e.g. from cluster managers
   │
   ├── reports                  <- Generated analyses and articles as html, pdf and more.
   |   ├── qc                   <- QC reports, including multiqc.html
   │   └── figures              <- Graphics for use in reports.
   │
   └── results                  <- Final results for sharing with collaborators, typically derived
       └── qc                   <- QC results



General analyses
=================

The analyses in this section apply to both individuals and pools.

QC
--

Numerous QC analyses have been performed:

``{{ "\n".join(snakemake.config["workflow"]["qc"]) }}``.

The results are stored in ``results/qc`` and summarized in
multiqc.html_.

All QC results can be regenerated by running

.. code-block:: shell

   snakemake all_qc


Trimming
--------

{% if snakemake.config["workflow"]["trim"] %}

Trimming has been performed with cutadapt. All read trimming can be
run as

.. code-block:: shell

   snakemake all_qc


{% else %}

Trimming has not been performed.

{% endif %}


Read mapping
------------

bwa was used to map reads to the reference ``{{ snakemake.config["db"]["ref"] }}``.

All reads can be mapped as

.. code-block:: shell

   snakemake all_map


Analyses of individual samples
==============================

Summary
-------

Main variant result files are found in ``results/ind/rawvc/gatkhc/{stage}/``
where stage is either unfiltered, select or filter.

Raw variant calling (``rawvc``)
--------------------------------

gatkhc
~~~~~~

All GATK calls can be generated as:

.. code-block:: shell

   snakemake all_rawvc


{% if 'bcftools' in snakemake.config["workflow"]["variantcallers"]["ind"] %}

bcftools
~~~~~~~~

{% endif %}

{% if 'freebayes' in snakemake.config["workflow"]["variantcallers"]["ind"] %}

freebayes
~~~~~~~~~

{% endif %}


Analyses of pooled samples
==========================



.. _manticore-smk: https://github.com/NBISweden/manticore-smk
.. _multiqc.html: ./qc/multiqc.html
.. _{{ snakemake.config["__workflow_commit__"] }}: {{ snakemake.config["__workflow_commit_link__"] }}
